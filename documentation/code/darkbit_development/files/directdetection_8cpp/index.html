<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://rc1242rc.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://rc1242rc.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://rc1242rc.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var e=localStorage.getItem("theme");e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://rc1242rc.github.io/main.f12f7e04ea768acebec10c86baf049d74d6a79f24bc0dfb7ed77aa60462432916dd1ce8f41c78b69496adf650b3039a28a210183cce598f09b95d6fecb5ff999.css integrity="sha512-8S9+BOp2is6+wQyGuvBJ101qefJLwN+37XeqYEYkMpFt0c6PQceLaUlq32ULMDmiiiEBg8zlmPCbldb+y1/5mQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>file src/DirectDetection.cpp - GAMBIT</title><meta name=description content="[No description available]"><link rel=canonical href=https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="file src/DirectDetection.cpp"><meta property="og:description" content="[No description available]"><meta property="og:url" content="https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/"><meta property="og:site_name" content="GAMBIT"><meta property="og:image" content="https://rc1242rc.github.io/gambit_logo.png"><meta property="og:image:alt" content="GAMBIT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="file src/DirectDetection.cpp"><meta name=twitter:description content="[No description available]"><meta name=twitter:image content="https://rc1242rc.github.io/gambit_logo.png"><meta name=twitter:image:alt content="file src/DirectDetection.cpp"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://rc1242rc.github.io/#/schema/organization/1","name":"Doks","url":"https://rc1242rc.github.io/","sameAs":["https://github.com/GambitBSM"],"logo":{"@type":"ImageObject","@id":"https://rc1242rc.github.io/#/schema/image/1","url":"https://rc1242rc.github.io/logo-doks.png","width":450,"height":416,"caption":"Doks"},"image":{"@id":"https://rc1242rc.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://rc1242rc.github.io/#/schema/website/1","url":"https://rc1242rc.github.io/","name":"GAMBIT","description":"Documentation for the Global And Modular BSM Inference Tool","publisher":{"@id":"https://rc1242rc.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/","url":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/","name":"file src\/DirectDetection.cpp","description":"[No description available]","isPartOf":{"@id":"https://rc1242rc.github.io/#/schema/website/1"},"about":{"@id":"https://rc1242rc.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/"]}]},{"@type":"BreadcrumbList","@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/","url":"https://rc1242rc.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/documentation/","url":"https://rc1242rc.github.io/documentation/","name":"Documentation"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/documentation/code/","url":"https://rc1242rc.github.io/documentation/code/","name":"Code"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/","url":"https://rc1242rc.github.io/documentation/code/darkbit_development/","name":"Darkbit Development"}},{"@type":"ListItem","position":5,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/","url":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/","name":"Files"}},{"@type":"ListItem","position":6,"item":{"@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://rc1242rc.github.io/documentation/code/darkbit_development/files/directdetection_8cpp/#/schema/image/2","url":"https://rc1242rc.github.io/gambit_logo.png","contentUrl":"https://rc1242rc.github.io/gambit_logo.png","caption":"file src\/DirectDetection.cpp"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://rc1242rc.github.io/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://rc1242rc.github.io/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://rc1242rc.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://rc1242rc.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://rc1242rc.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://rc1242rc.github.io/site.webmanifest></head><body class="documentation single light"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=https://rc1242rc.github.io/ aria-label=GAMBIT><img class=logo-light src=https://rc1242rc.github.io//images/gambit_logo.png width=50px>
<img class="logo-dark d-none" src=https://rc1242rc.github.io//images/gambit_logo.png width=50px>
GAMBIT</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>GAMBIT</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Documentation
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/documentation/installation/introduction/>Installation</a></li><li><a class=dropdown-item href=/documentation/examples/colliderbit>Examples</a></li><li><a class=dropdown-item href=/documentation/help/faqs/>Help</a></li><li><a class=dropdown-item href=/documentation/code/index_classes>Code Reference</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Community
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/community/publications/>Publications</a></li><li><a class=dropdown-item href=/community/talks/>Talks</a></li><li><a class=dropdown-item href=/community/members/>Members</a></li><li><a class=dropdown-item href=/community/code_of_conduct/>Code of Conduct</a></li><li><a class=dropdown-item href=/community/contact/>Contact</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search site..." aria-label="Search site..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/GambitBSM><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><div class=dropdown><button class="btn btn-doks-light dropdown-toggle" id=doks-versions data-bs-toggle=dropdown aria-expanded=false data-bs-display=static aria-label="Toggle version menu">
<span class=d-none>Doks</span>
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-lg-end me-lg-2 shadow rounded border-0" aria-labelledby=doks-versions></ul></div></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-installation aria-expanded=false>
Installation</button><div class=collapse id=section-installation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/installation/introduction/>Getting Started</a></li><li><a class="docs-link rounded" href=/documentation/installation/docker_usage/>Docker Usage</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_linux/>Installation for Linux</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_windows/>Installation for Windows</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_macos/>Installation for macOS</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-examples aria-expanded=false>
Examples</button><div class=collapse id=section-examples><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/examples/colliderbit/>ColliderBit</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit/>AnotherBit</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit2/>AnotherBit2</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-help aria-expanded=false>
Help</button><div class=collapse id=section-help><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/help/faqs/>FAQs</a></li><li><a class="docs-link rounded" href=/documentation/help/compiler_matrix/>Compiler Matrix</a></li><li><a class="docs-link rounded" href=/documentation/help/known_issues/>Known Issues</a></li><li><a class="docs-link rounded" href=/documentation/help/configuration_examples/>Configuration Examples</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-code aria-expanded=false>
Code Reference</button></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section- aria-expanded=false>
GAMBIT_VERSION_HERE</button><div class=collapse id=section-><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/code/colliderbit_development/index_classes/>Classes</a></li><li><a class="docs-link rounded" href=/documentation/code/colliderbit_development/index_files/>Files</a></li><li><a class="docs-link rounded" href=/documentation/code/colliderbit_development/index_pages/>Pages</a></li><li><a class="docs-link rounded" href=/documentation/code/colliderbit_development/index_namespaces/>Namespaces</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#defines>Defines</a></li><li><a href=#detailed-description>Detailed Description</a></li><li><a href=#macros-documentation>Macros Documentation</a><ul><li><a href=#define-ddcalc_result>define DDCALC_RESULT</a></li><li><a href=#define-ddcalc_bin>define DDCALC_BIN</a></li><li><a href=#define-dd_ex>define DD_EX</a></li></ul></li><li><a href=#source-code>Source code</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#defines>Defines</a></li><li><a href=#detailed-description>Detailed Description</a></li><li><a href=#macros-documentation>Macros Documentation</a><ul><li><a href=#define-ddcalc_result>define DDCALC_RESULT</a></li><li><a href=#define-ddcalc_bin>define DDCALC_BIN</a></li><li><a href=#define-dd_ex>define DD_EX</a></li></ul></li><li><a href=#source-code>Source code</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>file src/DirectDetection.cpp</h1><p class=lead></p><p>[No description available] <a href=#detailed-description>More&mldr;</a></p><h2 id=namespaces>Namespaces <a href=#namespaces class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>Name</th></tr></thead><tbody><tr><td><strong><a href=/documentation/code/darkbit_development/namespaces/namespacegambit/>Gambit</a></strong><br>TODO: see if we can use this one:</td></tr><tr><td><strong><a href=/documentation/code/darkbit_development/namespaces/namespacegambit_1_1darkbit/>Gambit::DarkBit</a></strong></td></tr></tbody></table><h2 id=defines>Defines <a href=#defines class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th></th><th>Name</th></tr></thead><tbody><tr><td></td><td><strong><a href=/documentation/code/darkbit_development/files/directdetection_8cpp/#define-ddcalc-result>DDCALC_RESULT</a></strong>(EXPERIMENT, TYPE, NAME)<br>Defines a prototypical DDCalc result extractor.</td></tr><tr><td></td><td><strong><a href=/documentation/code/darkbit_development/files/directdetection_8cpp/#define-ddcalc-bin>DDCALC_BIN</a></strong>(EXPERIMENT, TYPE, NAME)</td></tr><tr><td></td><td><strong><a href=/documentation/code/darkbit_development/files/directdetection_8cpp/#define-dd-ex>DD_EX</a></strong>(EXPERIMENT)</td></tr></tbody></table><h2 id=detailed-description>Detailed Description <a href=#detailed-description class=anchor aria-hidden=true>#</a></h2><p><strong>Author</strong>:</p><ul><li>Christopher Savage (<a href=mailto:chris@savage.name>chris@savage.name</a>)</li><li>Jonathan Cornell (<a href=mailto:jcornell@ucsc.edu>jcornell@ucsc.edu</a>)</li><li>Felix Kahlhoefer (<a href=mailto:felix.kahlhoefer@desy.de>felix.kahlhoefer@desy.de</a>)</li><li>Pat Scott (<a href=mailto:p.scott@imperial.ac.uk>p.scott@imperial.ac.uk</a>)</li><li>Sebastian Wild (<a href=mailto:sebastian.wild@desy.de>sebastian.wild@desy.de</a>)</li><li>Ankit Beniwal (<a href=mailto:ankit.beniwal@adelaide.edu.au>ankit.beniwal@adelaide.edu.au</a>)</li><li>Torsten Bringmann (<a href=mailto:torsten.bringmann@fys.uio.no>torsten.bringmann@fys.uio.no</a>)</li><li>Sanjay Bloor (<a href=mailto:sanjay.bloor12@imperial.ac.uk>sanjay.bloor12@imperial.ac.uk</a>)</li></ul><p><strong>Date</strong>:</p><ul><li>2014 Oct</li><li>2015 Jan, Feb, June</li><li>2015 Mar</li><li>2016 August</li><li>2015–2018</li><li>2017 October, November</li><li>2018 August</li><li>2019 May</li><li>2018 Sep</li><li>2020 Feb</li></ul><p>Routines for direct detection couplings and likelihoods.</p><hr><p>Authors (add name and date if you modify):</p><hr><h2 id=macros-documentation>Macros Documentation <a href=#macros-documentation class=anchor aria-hidden=true>#</a></h2><h3 id=define-ddcalc_result>define DDCALC_RESULT <a href=#define-ddcalc_result class=anchor aria-hidden=true>#</a></h3><pre><code>#define DDCALC_RESULT(
    EXPERIMENT,
    TYPE,
    NAME
)
    void CAT_3(EXPERIMENT,_Get,NAME)(TYPE &amp;result)                                 \
    {                                                                              \
      using namespace Pipes::CAT_3(EXPERIMENT,_Get,NAME);                          \
      TYPE temp_result = BEreq::CAT(DD_,NAME)(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));  \
      if (Utils::isnan(temp_result))                                               \
      {                                                                            \
        /* DarkBit_error().raise(LOCAL_INFO, &quot;Got NaN value from DDCalc.&quot;); */     \
        /* TODO: Raise a proper error here -- NaNs should be fixed. */             \
        invalid_point().raise(&quot;Got NaN value from DDCalc! This need fixing!&quot;);     \
      }                                                                            \
      result = temp_result;                                                        \
    }
</code></pre><p>Defines a prototypical DDCalc result extractor.</p><h3 id=define-ddcalc_bin>define DDCALC_BIN <a href=#define-ddcalc_bin class=anchor aria-hidden=true>#</a></h3><pre><code>#define DDCALC_BIN(
    EXPERIMENT,
    TYPE,
    NAME
)
    void CAT_3(EXPERIMENT,_GetBin,NAME)(std::vector&lt;double&gt; &amp;result)               \
    {                                                                              \
      using namespace Pipes::CAT_3(EXPERIMENT,_GetBin,NAME);                       \
      result.clear();                                                              \
      int nbins;                                                                   \
      nbins = BEreq::DD_Bins(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));         \
      for (int ibin=1;ibin&lt;=nbins;ibin++) {                                        \
        result.push_back(                                                          \
        BEreq::CAT(DD_Bin,NAME)(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)),ibin)); } \
    }
</code></pre><h3 id=define-dd_ex>define DD_EX <a href=#define-dd_ex class=anchor aria-hidden=true>#</a></h3><pre><code>#define DD_EX(
    EXPERIMENT
)
      /* Calculations */                                                           \
      void CAT(EXPERIMENT,_Calc)(bool &amp;result)                                     \
      {                                                                            \
        using namespace Pipes::CAT(EXPERIMENT,_Calc);                              \
        BEreq::DD_CalcRates(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));          \
        result = true;                                                             \
      }                                                                            \
      /* Results */                                                                \
      DDCALC_RESULT(EXPERIMENT, int,    Events)                                    \
      DDCALC_RESULT(EXPERIMENT, double, Background)                                \
      DDCALC_RESULT(EXPERIMENT, double, Signal)                                    \
      DDCALC_RESULT(EXPERIMENT, double, SignalSI)                                  \
      DDCALC_RESULT(EXPERIMENT, double, SignalSD)                                  \
      DDCALC_RESULT(EXPERIMENT, int,    Bins)                                      \
      DDCALC_RESULT(EXPERIMENT, double, LogLikelihood)                             \
      DDCALC_BIN(EXPERIMENT, int,    Events)                                       \
      DDCALC_BIN(EXPERIMENT, double, Background)                                   \
      DDCALC_BIN(EXPERIMENT, double, Signal)                                       \
</code></pre><p>Defines functions to perform the DDCalc internal rate calculations, and extract the results and log likelihoods, for the designated experiment.</p><h2 id=source-code>Source code <a href=#source-code class=anchor aria-hidden=true>#</a></h2><pre><code>//   GAMBIT: Global and Modular BSM Inference Tool
//   *********************************************

#include &quot;gambit/Elements/gambit_module_headers.hpp&quot;
#include &quot;gambit/DarkBit/DarkBit_rollcall.hpp&quot;

namespace Gambit
{
  namespace DarkBit
  {

    //
    //                 Direct detection couplings
    //

    void DD_couplings_DarkSUSY_DS5(DM_nucleon_couplings &amp;result)
    {
      using namespace Pipes::DD_couplings_DarkSUSY_DS5;

      double fG;

      // Set proton hadronic matrix elements
      BEreq::ddcom-&gt;ftp(7)  = *Param[&quot;fpu&quot;];
      BEreq::ddcom-&gt;ftp(8)  = *Param[&quot;fpd&quot;];
      BEreq::ddcom-&gt;ftp(10) = *Param[&quot;fps&quot;];

      fG = 2./27.*(1. - *Param[&quot;fpu&quot;] - *Param[&quot;fpd&quot;] - *Param[&quot;fps&quot;]);
      BEreq::ddcom-&gt;ftp(9) = fG;
      BEreq::ddcom-&gt;ftp(11) = fG;
      BEreq::ddcom-&gt;ftp(12) = fG;

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY proton hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftp(7) = fpu = &quot; &lt;&lt; BEreq::ddcom-&gt;ftp(7);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftp(8) = fpd = &quot; &lt;&lt; BEreq::ddcom-&gt;ftp(8);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftp(10) = fps = &quot; &lt;&lt; BEreq::ddcom-&gt;ftp(10) &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftp(9) = ftp(11) = ftp(12) = 2/27 fG = &quot; &lt;&lt;
        BEreq::ddcom-&gt;ftp(9) &lt;&lt; EOM;

      // Set neutron hadronic matrix elements
      BEreq::ddcom-&gt;ftn(7)  = *Param[&quot;fnu&quot;];
      BEreq::ddcom-&gt;ftn(8)  = *Param[&quot;fnd&quot;];
      BEreq::ddcom-&gt;ftn(10) = *Param[&quot;fns&quot;];

      fG = 2./27.*(1. - *Param[&quot;fnu&quot;] - *Param[&quot;fnd&quot;] - *Param[&quot;fns&quot;]);
      BEreq::ddcom-&gt;ftn(9) = fG;
      BEreq::ddcom-&gt;ftn(11) = fG;
      BEreq::ddcom-&gt;ftn(12) = fG;

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY neutron hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftn(7) = fnu = &quot; &lt;&lt; BEreq::ddcom-&gt;ftn(7);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftn(8) = fnd = &quot; &lt;&lt; BEreq::ddcom-&gt;ftn(8);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftn(10) = fns = &quot; &lt;&lt; BEreq::ddcom-&gt;ftn(10) &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftn(9) = ftn(11) = ftn(12) = 2/27 fG = &quot; &lt;&lt;
        BEreq::ddcom-&gt;ftn(9) &lt;&lt; EOM;

      // Set deltaq
      BEreq::ddcom-&gt;delu = *Param[&quot;deltau&quot;];
      BEreq::ddcom-&gt;deld = *Param[&quot;deltad&quot;];
      BEreq::ddcom-&gt;dels = *Param[&quot;deltas&quot;];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY delta q set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;delu = delta u = &quot; &lt;&lt; BEreq::ddcom-&gt;delu;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tdeld = delta d = &quot; &lt;&lt; BEreq::ddcom-&gt;deld;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tdels = delta s = &quot; &lt;&lt; BEreq::ddcom-&gt;dels &lt;&lt; EOM;


      // Loop corrections and pole removal.

      // Option loop&lt;bool&gt;: If true, include 1-loop effects discussed in
      // Drees Nojiri Phys.Rev. D48 (1993) 3483-3501 (default: true)
      BEreq::ddcom-&gt;dddn = runOptions-&gt;getValueOrDef&lt;bool&gt;(true,&quot;loop&quot;);

      // Option pole&lt;bool&gt;: If true, include pole in nuclear scattering cross-section.
      // If false, approximate squark propagator as 1/m_sq^2 (default: false)
      BEreq::ddcom-&gt;ddpole = runOptions-&gt;getValueOrDef&lt;bool&gt;(false,&quot;pole&quot;);

      // Some version notes:
      // The default in DS5 is to for both these options to be false (tree-level cross-section with pole removed).
      // The default in DS6 is to use Drees-Nojiri (1 loop) with the pole removed, which isn't an
      // option in the official DS5.1.3.  The version in GAMBIT is patched to implement this option though,
      // so we use it as the default here.

      // Calling DarkSUSY subroutine dsddgpgn(gps,gns,gpa,gna)
      // to set all four couplings.
      std::vector&lt;double&gt; DDcouplings=BEreq::get_DD_couplings();
      double factor =
      runOptions-&gt;getValueOrDef&lt;double&gt;(1., &quot;rescale_couplings&quot;);
      result.gps = factor*DDcouplings[0];// *= factor;
      result.gns = factor*DDcouplings[1];// *= factor;
      result.gpa = factor*DDcouplings[2];// *= factor;
      result.gna = factor*DDcouplings[3];// *= factor;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY dsddgpgn gives:&quot; &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gps = &quot; &lt;&lt; result.gps &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gns = &quot; &lt;&lt; result.gns &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gpa = &quot; &lt;&lt; result.gpa &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gna = &quot; &lt;&lt; result.gna &lt;&lt; EOM;
    }

    void DD_couplings_DarkSUSY_MSSM(DM_nucleon_couplings &amp;result)
    {
      using namespace Pipes::DD_couplings_DarkSUSY_MSSM;

      double fG;

      // Set proton hadronic matrix elements
      BEreq::ddcomlegacy-&gt;ftp(7)  = *Param[&quot;fpu&quot;];
      BEreq::ddcomlegacy-&gt;ftp(8)  = *Param[&quot;fpd&quot;];
      BEreq::ddcomlegacy-&gt;ftp(10) = *Param[&quot;fps&quot;];

      fG = 2./27.*(1. - *Param[&quot;fpu&quot;] - *Param[&quot;fpd&quot;] - *Param[&quot;fps&quot;]);
      BEreq::ddcomlegacy-&gt;ftp(9) = fG;
      BEreq::ddcomlegacy-&gt;ftp(11) = fG;
      BEreq::ddcomlegacy-&gt;ftp(12) = fG;

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY proton hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftp(7) = fpu = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftp(7);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftp(8) = fpd = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftp(8);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftp(10) = fps = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftp(10) &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftp(9) = ftp(11) = ftp(12) = 2/27 fG = &quot; &lt;&lt;
        BEreq::ddcomlegacy-&gt;ftp(9) &lt;&lt; EOM;

      // Set neutron hadronic matrix elements
      BEreq::ddcomlegacy-&gt;ftn(7)  = *Param[&quot;fnu&quot;];
      BEreq::ddcomlegacy-&gt;ftn(8)  = *Param[&quot;fnd&quot;];
      BEreq::ddcomlegacy-&gt;ftn(10) = *Param[&quot;fns&quot;];

      fG = 2./27.*(1. - *Param[&quot;fnu&quot;] - *Param[&quot;fnd&quot;] - *Param[&quot;fns&quot;]);
      BEreq::ddcomlegacy-&gt;ftn(9) = fG;
      BEreq::ddcomlegacy-&gt;ftn(11) = fG;
      BEreq::ddcomlegacy-&gt;ftn(12) = fG;

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY neutron hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftn(7) = fnu = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftn(7);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftn(8) = fnd = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftn(8);
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tftn(10) = fns = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;ftn(10) &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ftn(9) = ftn(11) = ftn(12) = 2/27 fG = &quot; &lt;&lt;
        BEreq::ddcomlegacy-&gt;ftn(9) &lt;&lt; EOM;

      // Set deltaq
      BEreq::ddcomlegacy-&gt;delu = *Param[&quot;deltau&quot;];
      BEreq::ddcomlegacy-&gt;deld = *Param[&quot;deltad&quot;];
      BEreq::ddcomlegacy-&gt;dels = *Param[&quot;deltas&quot;];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY delta q set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;delu = delta u = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;delu;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tdeld = delta d = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;deld;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tdels = delta s = &quot; &lt;&lt; BEreq::ddcomlegacy-&gt;dels &lt;&lt; EOM;


      // Loop corrections and pole removal.

      // Option loop&lt;bool&gt;: If true, include 1-loop effects discussed in
      // Drees Nojiri Phys.Rev. D48 (1993) 3483-3501 (default: true)
      BEreq::ddmssmcom-&gt;dddn = runOptions-&gt;getValueOrDef&lt;bool&gt;(true,&quot;loop&quot;);

      // Option pole&lt;bool&gt;: If true, include pole in nuclear scattering cross-section.
      // If false, approximate squark propagator as 1/m_sq^2 (default: false)
      BEreq::ddmssmcom-&gt;ddpole = runOptions-&gt;getValueOrDef&lt;bool&gt;(false,&quot;pole&quot;);

      // Some version notes:
      // The default in DS5 is  for both these options to be false (tree-level cross-section with pole removed).
      // The default in DS6 is to use Drees-Nojiri (1 loop) with the pole removed, which isn't an
      // option in the official DS5.1.3.  The version in GAMBIT is patched to implement this option though,
      // so we use it as the default here.

      // Calling DarkSUSY subroutine dsddgpgn(gps,gns,gpa,gna)
      // to set all four couplings.
      std::vector&lt;double&gt; DDcouplings=BEreq::get_DD_couplings();
      double factor =
      runOptions-&gt;getValueOrDef&lt;double&gt;(1., &quot;rescale_couplings&quot;);
      result.gps = factor*DDcouplings[0];// *= factor;
      result.gns = factor*DDcouplings[1];// *= factor;
      result.gpa = factor*DDcouplings[2];// *= factor;
      result.gna = factor*DDcouplings[3];// *= factor;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;DarkSUSY dsddgpgn gives:&quot; &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gps = &quot; &lt;&lt; result.gps &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gns = &quot; &lt;&lt; result.gns &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gpa = &quot; &lt;&lt; result.gpa &lt;&lt; std::endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gna = &quot; &lt;&lt; result.gna &lt;&lt; EOM;
    }


    void DD_couplings_MicrOmegas(DM_nucleon_couplings &amp;result)
    {
      using namespace Pipes::DD_couplings_MicrOmegas;

      // Set proton hadronic matrix elements.
      BEreq::MOcommon-&gt;par[2] = *Param[&quot;fpd&quot;];
      BEreq::MOcommon-&gt;par[3] = *Param[&quot;fpu&quot;];
      BEreq::MOcommon-&gt;par[4] = *Param[&quot;fps&quot;];

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;micrOMEGAs proton hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ScalarFFPd = fpd = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[2];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tScalarFFPu = fpu = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[3];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tScalarFFPs = fps = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[4] &lt;&lt; EOM;

      // Set neutron hadronic matrix elements.
      BEreq::MOcommon-&gt;par[11] = *Param[&quot;fnd&quot;];
      BEreq::MOcommon-&gt;par[12] = *Param[&quot;fnu&quot;];
      BEreq::MOcommon-&gt;par[13] = *Param[&quot;fns&quot;];

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;micrOMEGAs neutron hadronic matrix elements set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;ScalarFFNd = fnd = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[11];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tScalarFFNu = fnu = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[12];
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;\tScalarFFNs = fns = &quot; &lt;&lt; BEreq::MOcommon-&gt;par[13] &lt;&lt; EOM;

      //Set delta q.
      BEreq::MOcommon-&gt;par[5] = *Param[&quot;deltad&quot;];
      BEreq::MOcommon-&gt;par[6] = *Param[&quot;deltau&quot;];
      BEreq::MOcommon-&gt;par[7] = *Param[&quot;deltas&quot;];

      BEreq::MOcommon-&gt;par[14] = *Param[&quot;deltau&quot;];
      BEreq::MOcommon-&gt;par[15] = *Param[&quot;deltad&quot;];
      BEreq::MOcommon-&gt;par[16] = *Param[&quot;deltas&quot;];

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;micrOMEGAs delta q set to:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;pVectorFFPd = pVectorFFNu = delta d = &quot;
        &lt;&lt; BEreq::MOcommon-&gt;par[5] &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;pVectorFFPu = pVectorFFPd = delta u = &quot;
        &lt;&lt; BEreq::MOcommon-&gt;par[6] &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;pVectorFFPs = pVectorFFNs = delta s = &quot;
        &lt;&lt; BEreq::MOcommon-&gt;par[7] &lt;&lt; EOM;

      double p1[2], p2[2], p3[2], p4[2];
      int error;
      if (runOptions-&gt;getValueOrDef&lt;bool&gt;(true, &quot;box&quot;))
        error = BEreq::nucleonAmplitudes(byVal(BEreq::FeScLoop.pointer()),
          byVal(p1), byVal(p2), byVal(p3), byVal(p4));
      else error = BEreq::nucleonAmplitudes(NULL,
              byVal(p1), byVal(p2), byVal(p3), byVal(p4));
      if(error!=0)
        DarkBit_error().raise(LOCAL_INFO,
            &quot;micrOMEGAs nucleonAmplitudes function failed with &quot;
            &quot;error code &quot; + std::to_string(error) + &quot;.&quot;);

      // Rescaling to agree with DarkSUSY convention:
      result.gps = p1[0]*2;
      result.gpa = p2[0]*2;
      result.gns = p3[0]*2;
      result.gna = p4[0]*2;

      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot;micrOMEGAs nucleonAmplitudes gives:&quot; &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gps: &quot; &lt;&lt; result.gps &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gns: &quot; &lt;&lt; result.gns &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gpa: &quot; &lt;&lt; result.gpa &lt;&lt; endl;
      logger() &lt;&lt; LogTags::debug &lt;&lt; &quot; gna: &quot; &lt;&lt; result.gna &lt;&lt; EOM;
    }

    void sigma_SI_p_simple(double &amp;result)
    {
      using namespace Pipes::sigma_SI_p_simple;
      double gps = Dep::DD_couplings-&gt;gps;
      double reduced_mass = *Dep::mwimp * m_proton / (*Dep::mwimp + m_proton);
      result = gev2cm2/pi*pow(reduced_mass*gps,2.0);
    }

    void sigma_SI_n_simple(double &amp;result)
    {
      using namespace Pipes::sigma_SI_n_simple;
      double gns = Dep::DD_couplings-&gt;gns;
      double reduced_mass = *Dep::mwimp * m_neutron / (*Dep::mwimp + m_neutron);
      result = gev2cm2/pi*pow(reduced_mass*gns,2.0);
    }

    void sigma_SD_p_simple(double &amp;result)
    {
      using namespace Pipes::sigma_SD_p_simple;
      double gpa = Dep::DD_couplings-&gt;gpa;
      double reduced_mass = *Dep::mwimp * m_proton / (*Dep::mwimp + m_proton);
      result = 3.0*gev2cm2/pi*pow(reduced_mass*gpa,2.0);
    }

    void sigma_SD_n_simple(double &amp;result)
    {
      using namespace Pipes::sigma_SD_n_simple;
      double gna = Dep::DD_couplings-&gt;gna;
      double reduced_mass = *Dep::mwimp * m_neutron / (*Dep::mwimp + m_neutron);
      result = 3.0*gev2cm2/pi*pow(reduced_mass*gna,2.0);
    }

    void sigma_SI_vnqn_FermionicHiggsPortal(map_intpair_dbl &amp;result)
    {
      using namespace Pipes::sigma_SI_vnqn_FermionicHiggsPortal;

      NREO_DM_nucleon_couplings wilsonCoeffs = *Dep::DD_nonrel_WCs;

      double q0 = 0.04; // reference momentum transfer: 40 MeV
      double gps = (wilsonCoeffs.c0[1] + wilsonCoeffs.c1[1])/2. ;
      double gpa = (wilsonCoeffs.c0[11] + wilsonCoeffs.c1[11])/2.;
      double reduced_mass = *Dep::mwimp * m_proton / (*Dep::mwimp + m_proton);

      result[std::make_pair(0,0)] =   gev2cm2/pi*pow(reduced_mass*gps,2.0);
      result[std::make_pair(-2,0)] =  0.0;
      result[std::make_pair(2,0)] =   gev2cm2/pi*pow(reduced_mass*gpa,2.0)*pow(q0/(*Dep::mwimp)/2.0,2.0);
      result[std::make_pair(4,0)] =   0.0;
      result[std::make_pair(0,-2)] =  0.0;
      result[std::make_pair(0,2)] =   0.0;
      result[std::make_pair(0,4)] =   0.0;
    }

    void sigma_SD_vnqn_FermionicHiggsPortal(map_intpair_dbl &amp;result)
    {
      using namespace Pipes::sigma_SD_vnqn_FermionicHiggsPortal;

      result[std::make_pair(0,0)] =   0.0;
      result[std::make_pair(-2,0)] =  0.0;
      result[std::make_pair(2,0)] =   0.0;
      result[std::make_pair(4,0)] =   0.0;
      result[std::make_pair(0,-2)] =  0.0;
      result[std::make_pair(0,2)] =   0.0;
      result[std::make_pair(0,4)] =   0.0;
    }


    // Using spin-independent/spin-dependent interactions only
    void DDCalc_Couplings_WIMP_nucleon(DD_coupling_container &amp;result)
    {
      using namespace Pipes::DDCalc_Couplings_WIMP_nucleon;
      result.coeff_structure = 1;
      result.DM_nucleon_coeffs = *Dep::DD_couplings;
    }

    // Using non-relativistic Wilson Coefficient coupling structure
    void DDCalc_Couplings_NR_WCs(DD_coupling_container &amp;result)
    {
      using namespace Pipes::DDCalc_Couplings_NR_WCs;
      result.coeff_structure = 2;
      result.DD_nonrel_WCs = *Dep::DD_nonrel_WCs;
    }

    //
    //          Direct detection rate and likelihood routines
    //

    #define DDCALC_RESULT(EXPERIMENT, TYPE, NAME)                                  \
    void CAT_3(EXPERIMENT,_Get,NAME)(TYPE &amp;result)                                 \
    {                                                                              \
      using namespace Pipes::CAT_3(EXPERIMENT,_Get,NAME);                          \
      TYPE temp_result = BEreq::CAT(DD_,NAME)(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));  \
      if (Utils::isnan(temp_result))                                               \
      {                                                                            \
        /* DarkBit_error().raise(LOCAL_INFO, &quot;Got NaN value from DDCalc.&quot;); */     \
        /* TODO: Raise a proper error here -- NaNs should be fixed. */             \
        invalid_point().raise(&quot;Got NaN value from DDCalc! This need fixing!&quot;);     \
      }                                                                            \
      result = temp_result;                                                        \
    }

    #define DDCALC_BIN(EXPERIMENT, TYPE, NAME)                                     \
    void CAT_3(EXPERIMENT,_GetBin,NAME)(std::vector&lt;double&gt; &amp;result)               \
    {                                                                              \
      using namespace Pipes::CAT_3(EXPERIMENT,_GetBin,NAME);                       \
      result.clear();                                                              \
      int nbins;                                                                   \
      nbins = BEreq::DD_Bins(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));         \
      for (int ibin=1;ibin&lt;=nbins;ibin++) {                                        \
        result.push_back(                                                          \
        BEreq::CAT(DD_Bin,NAME)(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)),ibin)); } \
    }

    #define DD_EX(EXPERIMENT)                                                      \
      /* Calculations */                                                           \
      void CAT(EXPERIMENT,_Calc)(bool &amp;result)                                     \
      {                                                                            \
        using namespace Pipes::CAT(EXPERIMENT,_Calc);                              \
        BEreq::DD_CalcRates(BEreq::DD_Experiment(STRINGIFY(EXPERIMENT)));          \
        result = true;                                                             \
      }                                                                            \
      /* Results */                                                                \
      DDCALC_RESULT(EXPERIMENT, int,    Events)                                    \
      DDCALC_RESULT(EXPERIMENT, double, Background)                                \
      DDCALC_RESULT(EXPERIMENT, double, Signal)                                    \
      DDCALC_RESULT(EXPERIMENT, double, SignalSI)                                  \
      DDCALC_RESULT(EXPERIMENT, double, SignalSD)                                  \
      DDCALC_RESULT(EXPERIMENT, int,    Bins)                                      \
      DDCALC_RESULT(EXPERIMENT, double, LogLikelihood)                             \
      DDCALC_BIN(EXPERIMENT, int,    Events)                                       \
      DDCALC_BIN(EXPERIMENT, double, Background)                                   \
      DDCALC_BIN(EXPERIMENT, double, Signal)                                       \

    // Experiments
    DD_EX(XENON100_2012)        // Aprile et al., PRL 109, 181301 (2013) [arxiv:1207.5988]
    DD_EX(XENON1T_2017)         // Aprile et al., PRL 119, 181301 (2017) [arxiv:1705.06655]
    DD_EX(XENON1T_2018)         // Aprile et al., May 28 talk at Gran Sasso.
    DD_EX(DARWIN)               // M. Schumann et al., [arXiv:1506.08309]
    DD_EX(LUX_2013)             // Akerib et al., PRL 112, 091303 (2014) [arxiv:1310.8214]
    DD_EX(LUX_2015)             // D.S. Akerib et al., PRL 116, 161301 (2016) [arXiv:1512.03506]
    DD_EX(LUX_2016)             // D.S. Akerib et al., PRL 118, 021303 (2017) [arxiv:1608.07648]
    DD_EX(LZ)                   // LZ TDR, [arXiv:1509.02910]
    DD_EX(PandaX_2016)          // A. Tan et al., PRL 117, 121303 (2016) [arxiv:1607.07400]
    DD_EX(PandaX_2017)          // X. Cui et al., PRL 119, 181302 (2017) [arxiv:1708.06917]
    DD_EX(DarkSide_50)          // P. Agnes et al., [arXiv:1802.07198]
    DD_EX(DarkSide_50_S2)       // P. Agnes et al., [arXiv:1802.06994]
    DD_EX(CRESST_II)            // G. Angloher et al., [arXiv:1509.01515]
    DD_EX(CRESST_III)           // G. Angloher et al., [arXiv:1904.00498]
    DD_EX(SuperCDMS_2014)       // Agnese et al., PRL 112, 241302 (2014) [arxiv:1402.7137]
    DD_EX(CDMSlite)             // Agnese et al., PRL 116, 071301 (2015) [arxiv:1509.02448]
    DD_EX(SIMPLE_2014)          // Felizardo et al., PRD 89, 072013 (2014) [arxiv:1404.4309]
    DD_EX(PICO_2L)              // C. Amole et al., PRD 93, 061101 (2016) [arXiv:1601.03729]
    DD_EX(PICO_60_F)            // C. Amole et al., PRD 93, 052014 (2016) [arXiv:1510.07754]
    DD_EX(PICO_60_I)            // C. Amole et al., PRD 93, 052014 (2016) [arXiv:1510.07754]
    DD_EX(PICO_60)              // C. Amole et al., PRD 93, 052014 (2016) [arXiv:1510.07754]
    DD_EX(PICO_60_2017)         // C. Amole et al., arXiv:1702.07666
    DD_EX(PICO_60_2019)         // C. Amole et al., arXiv:1902.04031
    DD_EX(PICO_500)             // S. Fallows, talk at TAUP 2017

    // Just in case, to make sure we don't mess with other things elsewhere.
    #undef DD_EX

  }
}
</code></pre><hr><p>Updated on 2022-08-02 at 18:18:46 +0000</p><div class=edit-page><a href=https://github.com/RC1242RC/gambit_gh_pages/blob/master/content/en/documentation/code/DarkBit_development/Files/DirectDetection_8cpp.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://www.netlify.com/>Netlify</a>, <a class=text-muted href=https://gohugo.io/>Hugo</a>, and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/license/>License</a></li></ul></div></div></div></footer><script src=/js/bootstrap.min.54bf0932b8a36d0e152b1635b099a6ef1394d35327e2437550a075c9c8ed1bd8aed5847c21b36fc02ed24014c031d9ca24017b0c78b1639d7e2fa8329898b842.js integrity="sha512-VL8JMrijbQ4VKxY1sJmm7xOU01Mn4kN1UKB1ycjtG9iu1YR8IbNvwC7SQBTAMdnKJAF7DHixY51+L6gymJi4Qg==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.5b48bc253dc75aeea5fb366ecf700f4925e2b6eb1a1466f2124b722d68148d67bc0a9365d2b8ad9c585161b46372d23b08509a16f1fd518542b894756d4752d0.js integrity="sha512-W0i8JT3HWu6l+zZuz3APSSXitusaFGbyEktyLWgUjWe8CpNl0ritnFhRYbRjctI7CFCaFvH9UYVCuJR1bUdS0A==" crossorigin=anonymous defer></script>
<script src=/main.min.40265e9a032aeba5eaf67baac3cbbc22667a7533215d326eeb3e9f4d5e4be40f9ff4dcd22949db73ae527ca26a19d7998091a8973c82af760b2c0daa335190ed.js integrity="sha512-QCZemgMq66Xq9nuqw8u8ImZ6dTMhXTJu6z6fTV5L5A+f9NzSKUnbc65SfKJqGdeZgJGolzyCr3YLLA2qM1GQ7Q==" crossorigin=anonymous defer></script>
<script src=https://rc1242rc.github.io/index.min.bf15e814991a9d3ef02f52a26d135d3cd0a098afc407e971daad9f276d437236be129db79cd96bd09f86d0730d8272253cdaff9edd528739d4fc2013efa8d4ba.js integrity="sha512-vxXoFJkanT7wL1KibRNdPNCgmK/EB+lx2q2fJ21Dcja+Ep23nNlr0J+G0HMNgnIlPNr/nt1ShznU/CAT76jUug==" crossorigin=anonymous defer></script></body></html>