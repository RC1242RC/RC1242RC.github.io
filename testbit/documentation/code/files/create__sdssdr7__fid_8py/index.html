<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://rc1242rc.github.io/testbit/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://rc1242rc.github.io/testbit/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://rc1242rc.github.io/testbit/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var e=localStorage.getItem("theme");e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://rc1242rc.github.io/testbit/main.1fa2debdf0a1b20e7268d11906902449af896197928a5bdae9dca95b629cdd73746db3d8c6afacb7320d9deb149a318c764669d08a1ddfd34a657ab2aeab866a.css integrity="sha512-H6LevfChsg5yaNEZBpAkSa+JYZeSilva6dypW2Kc3XN0bbPYxq+stzINnesUmjGMdkZp0Iod39NKZXqyrquGag==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>file classy/create_SDSSDR7_fid.py - GAMBIT</title><meta name=description content="[No description available]"><link rel=canonical href=https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="file classy/create_SDSSDR7_fid.py"><meta property="og:description" content="[No description available]"><meta property="og:url" content="https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/"><meta property="og:site_name" content="GAMBIT"><meta property="og:image" content="https://rc1242rc.github.io/testbit/gambit_logo.png"><meta property="og:image:alt" content="GAMBIT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="file classy/create_SDSSDR7_fid.py"><meta name=twitter:description content="[No description available]"><meta name=twitter:image content="https://rc1242rc.github.io/testbit/gambit_logo.png"><meta name=twitter:image:alt content="file classy/create_SDSSDR7_fid.py"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://rc1242rc.github.io/#/schema/organization/1","name":"Doks","url":"https://rc1242rc.github.io/","sameAs":["https://github.com/GambitBSM"],"logo":{"@type":"ImageObject","@id":"https://rc1242rc.github.io/#/schema/image/1","url":"https://rc1242rc.github.io/logo-doks.png","width":450,"height":416,"caption":"Doks"},"image":{"@id":"https://rc1242rc.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://rc1242rc.github.io/#/schema/website/1","url":"https://rc1242rc.github.io/","name":"GAMBIT","description":"Documentation for the Global And Modular BSM Inference Tool","publisher":{"@id":"https://rc1242rc.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/","url":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/","name":"file classy\/create_SDSSDR7_fid.py","description":"[No description available]","isPartOf":{"@id":"https://rc1242rc.github.io/#/schema/website/1"},"about":{"@id":"https://rc1242rc.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/"]}]},{"@type":"BreadcrumbList","@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/testbit","url":"https://rc1242rc.github.io/testbit","name":"Home"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/testbit/documentation/","url":"https://rc1242rc.github.io/testbit/documentation/","name":"Documentation"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/testbit/documentation/code/","url":"https://rc1242rc.github.io/testbit/documentation/code/","name":"Code"}},{"@type":"ListItem","position":5,"item":{"@type":"WebPage","@id":"https://rc1242rc.github.io/testbit/documentation/code/files/","url":"https://rc1242rc.github.io/testbit/documentation/code/files/","name":"Files"}},{"@type":"ListItem","position":6,"item":{"@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://rc1242rc.github.io/testbit/documentation/code/files/create__sdssdr7__fid_8py/#/schema/image/2","url":"https://rc1242rc.github.io/testbit/gambit_logo.png","contentUrl":"https://rc1242rc.github.io/testbit/gambit_logo.png","caption":"file classy\/create_SDSSDR7_fid.py"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://rc1242rc.github.io/testbit/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://rc1242rc.github.io/testbit/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://rc1242rc.github.io/testbit/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://rc1242rc.github.io/testbit/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://rc1242rc.github.io/testbit/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://rc1242rc.github.io/testbit/site.webmanifest></head><body class="documentation single light"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=GAMBIT><img class=logo-light src=https://rc1242rc.github.io/testbit/images/gambit_logo.png width=50px>
<img class="logo-dark d-none" src=https://rc1242rc.github.io/testbit/images/gambit_logo.png width=50px>
GAMBIT</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>GAMBIT</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Documentation
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/testbit/documentation/installation/introduction/>Installation</a></li><li><a class=dropdown-item href=/testbit/documentation/examples/colliderbit>Examples</a></li><li><a class=dropdown-item href=/testbit/documentation/help/faqs/>Help</a></li><li><a class=dropdown-item href=/testbit/documentation/code/index_classes>Code Reference</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Community
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/testbit/community/publications/>Publications</a></li><li><a class=dropdown-item href=/testbit/community/talks/>Talks</a></li><li><a class=dropdown-item href=/testbit/community/members/>Members</a></li><li><a class=dropdown-item href=/testbit/community/code_of_conduct/>Code of Conduct</a></li><li><a class=dropdown-item href=/testbit/community/contact/>Contact</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search site..." aria-label="Search site..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/GambitBSM><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><div class=dropdown><button class="btn btn-doks-light dropdown-toggle" id=doks-versions data-bs-toggle=dropdown aria-expanded=false data-bs-display=static aria-label="Toggle version menu">
<span class=d-none>Doks</span> TestBit
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-lg-end me-lg-2 shadow rounded border-0" aria-labelledby=doks-versions><li><a class=dropdown-item href=/maindevelopment/documentation/code/index_classes/>MainDevelopment</a></li><li><a class=dropdown-item href=/testbit/documentation/code/index_classes/>TestBit</a></li></ul></div></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-installation aria-expanded=false>
Installation</button><div class=collapse id=section-installation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/testbit/documentation/installation/introduction/>Getting Started</a></li><li><a class="docs-link rounded" href=/testbit/documentation/installation/docker_usage/>Docker Usage</a></li><li><a class="docs-link rounded" href=/testbit/documentation/installation/installation_for_linux/>Installation for Linux</a></li><li><a class="docs-link rounded" href=/testbit/documentation/installation/installation_for_windows/>Installation for Windows</a></li><li><a class="docs-link rounded" href=/testbit/documentation/installation/installation_for_macos/>Installation for macOS</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-examples aria-expanded=false>
Examples</button><div class=collapse id=section-examples><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/testbit/documentation/examples/colliderbit/>ColliderBit</a></li><li><a class="docs-link rounded" href=/testbit/documentation/examples/anotherbit/>AnotherBit</a></li><li><a class="docs-link rounded" href=/testbit/documentation/examples/anotherbit2/>AnotherBit2</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-help aria-expanded=false>
Help</button><div class=collapse id=section-help><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/testbit/documentation/help/faqs/>FAQs</a></li><li><a class="docs-link rounded" href=/testbit/documentation/help/compiler_matrix/>Compiler Matrix</a></li><li><a class="docs-link rounded" href=/testbit/documentation/help/known_issues/>Known Issues</a></li><li><a class="docs-link rounded" href=/testbit/documentation/help/configuration_examples/>Configuration Examples</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-code aria-expanded=false>
Code Reference</button><div class=collapse id=section-code><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/testbit/documentation/code/index_classes/>Classes</a></li><li><a class="docs-link rounded" href=/testbit/documentation/code/index_files/>Files</a></li><li><a class="docs-link rounded" href=/testbit/documentation/code/index_pages/>Pages</a></li><li><a class="docs-link rounded" href=/testbit/documentation/code/index_namespaces/>Namespaces</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#source-code>Source code</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#source-code>Source code</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>file classy/create_SDSSDR7_fid.py</h1><p class=lead></p><p>[No description available]</p><h2 id=namespaces>Namespaces <a href=#namespaces class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>Name</th></tr></thead><tbody><tr><td><strong><a href=/documentation/code/namespaces/namespacecreate__sdssdr7__fid/>create_SDSSDR7_fid</a></strong></td></tr></tbody></table><h2 id=source-code>Source code <a href=#source-code class=anchor aria-hidden=true>#</a></h2><pre><code>import numpy as np
import math
import scipy.integrate
import scipy.interpolate
import sys

# global variable to detect python version
# needed to avoid compatibility issues below
PYTHON3 = True
if sys.version_info[0] &lt; 3:
  PYTHON3 = False


'''
  Script to compute the spectra of the fiducial cosmology needed for the 
  MontePython SDSS DR7 LRG likelihood. The file containing the fiducial spectra
  is saved as Backends/installed/class/&lt;version&gt;/sdss_lrgDR7_fiducialmodel.dat
  All routines taken and adopted from MontePython. 
  
  Why do we need this? 
    In MontePython, this file is created if it does not exist in the MP data folder. 
    However, the results depend on the treatment of the non linearities. Hence, it is 
    not guaranteed to be (CLASS) version independent. To ensure this for the use with
    GAMBIT, we execute this script after the build step of each CLASS version and save
    the resulting spectra in the installation folder of the respective CLASS version. 
    When running MontePython, we pass the path to the CLASS version that is used for
    the current GAMBIT run. Therefore, we avoid all potential inconsistencies related to the use
    of different CLASS versions for the computation of the likelihood and the calculation
    of the fiducial spectra.

  This script also fixes some compatibility issues with python3. 

  author: Janina Renk, janina.renk@fysik.su.se
    July 2020
'''

def remove_bao(k_in,pk_in):
  '''From MontePython 3.3.0, minor changes to work as stand-alone function
  '''
  # De-wiggling routine by Mario Ballardini
  # This k range has to contain the BAO features:
  k_ref=[2.8e-2, 4.5e-1]
  # Get interpolating function for input P(k) in log-log space:
  _interp_pk = scipy.interpolate.interp1d( np.log(k_in), np.log(pk_in),
                                           kind='quadratic', bounds_error=False )
  interp_pk = lambda x: np.exp(_interp_pk(np.log(x)))
  # Spline all (log-log) points outside k_ref range:
  idxs = np.where(np.logical_or(k_in &lt;= k_ref[0], k_in &gt;= k_ref[1]))
  _pk_smooth = scipy.interpolate.UnivariateSpline( np.log(k_in[idxs]),
                                                   np.log(pk_in[idxs]), k=3, s=0 )
  pk_smooth = lambda x: np.exp(_pk_smooth(np.log(x)))
  # Find second derivative of each spline:
  fwiggle = scipy.interpolate.UnivariateSpline(k_in, pk_in / pk_smooth(k_in), k=3, s=0)
  derivs = np.array([fwiggle.derivatives(_k) for _k in k_in]).T
  d2 = scipy.interpolate.UnivariateSpline(k_in, derivs[2], k=3, s=1.0)
  # Find maxima and minima of the gradient (zeros of 2nd deriv.), then put a
  # low-order spline through zeros to subtract smooth trend from wiggles fn.
  wzeros = d2.roots()
  wzeros = wzeros[np.where(np.logical_and(wzeros &gt;= k_ref[0], wzeros &lt;= k_ref[1]))]
  wzeros = np.concatenate((wzeros, [k_ref[1],]))
  wtrend = scipy.interpolate.UnivariateSpline(wzeros, fwiggle(wzeros), k=3, s=0)
  # Construct smooth no-BAO:
  idxs = np.where(np.logical_and(k_in &gt; k_ref[0], k_in &lt; k_ref[1]))
  pk_nobao = pk_smooth(k_in)
  pk_nobao[idxs] *= wtrend(k_in[idxs])
  # Construct interpolating functions:
  ipk = scipy.interpolate.interp1d( k_in, pk_nobao, kind='linear',
                                    bounds_error=False, fill_value=0. )
  pk_nobao = ipk(k_in)
  return pk_nobao

def get_flat_fid(cosmo,kh,z,sigma2bao,h):
  '''From MontePython 3.3.0, minor changes to work as stand-alone function
  '''

  # SDSS DR7 LRG specific function
  # Compute fiducial properties for a flat fiducial
  # with Omega_m = 0.25, Omega_L = 0.75, h = 0.701
  
  k = kh*h
  # P(k) *with* wiggles, both linear and nonlinear
  Plin = np.zeros(len(k), 'float64')
  Pnl = np.zeros(len(k), 'float64')
  # P(k) *without* wiggles, both linear and nonlinear
  Psmooth = np.zeros(len(k), 'float64')
  Psmooth_nl = np.zeros(len(k), 'float64')
  # Damping function and smeared P(k)
  fdamp = np.zeros([len(k), len(z)], 'float64')
  Psmear = np.zeros([len(k), len(z)], 'float64')
  # Ratio of smoothened non-linear to linear P(k)
  fidnlratio = np.zeros([len(k), len(z)], 'float64')
  # Loop over each redshift bin
  for j in range(len(z)):
    # Compute Pk *with* wiggles, both linear and nonlinear
    # Get P(k) at right values of k in Mpc**3, convert it to (Mpc/h)^3 and rescale it
    # Get values of P(k) in Mpc**3
    for i in range(len(k)):
        Plin[i] = cosmo.pk_lin(k[i], z[j])
        Pnl[i] = cosmo.pk(k[i], z[j])
    # Get rescaled values of P(k) in (Mpc/h)**3
    Plin *= h**3 #(h/scaling)**3
    Pnl *= h**3 #(h/scaling)**3
    # Compute Pk *without* wiggles, both linear and nonlinear
    Psmooth = remove_bao(kh,Plin)
    Psmooth_nl = remove_bao(kh,Pnl)
    # Apply Gaussian damping due to non-linearities
    fdamp[:,j] = np.exp(-0.5*sigma2bao[j]*kh**2)
    Psmear[:,j] = Plin*fdamp[:,j]+Psmooth*(1.0-fdamp[:,j])
    # Take ratio of smoothened non-linear to linear P(k)
    fidnlratio[:,j] = Psmooth_nl/Psmooth

  # Polynomials to shape small scale behaviour from N-body sims
  kdata=kh
  fidpolyNEAR=np.zeros(np.size(kdata))
  fidpolyNEAR[kdata&lt;=0.194055] = (1.0 - 0.680886*kdata[kdata&lt;=0.194055] + 6.48151*kdata[kdata&lt;=0.194055]**2)
  fidpolyNEAR[kdata&gt;0.194055] = (1.0 - 2.13627*kdata[kdata&gt;0.194055] + 21.0537*kdata[kdata&gt;0.194055]**2 - 50.1167*kdata[kdata&gt;0.194055]**3 + 36.8155*kdata[kdata&gt;0.194055]**4)*1.04482
  fidpolyMID=np.zeros(np.size(kdata))
  fidpolyMID[kdata&lt;=0.19431] = (1.0 - 0.530799*kdata[kdata&lt;=0.19431] + 6.31822*kdata[kdata&lt;=0.19431]**2)
  fidpolyMID[kdata&gt;0.19431] = (1.0 - 1.97873*kdata[kdata&gt;0.19431] + 20.8551*kdata[kdata&gt;0.19431]**2 - 50.0376*kdata[kdata&gt;0.19431]**3 + 36.4056*kdata[kdata&gt;0.19431]**4)*1.04384
  fidpolyFAR=np.zeros(np.size(kdata))
  fidpolyFAR[kdata&lt;=0.19148] = (1.0 - 0.475028*kdata[kdata&lt;=0.19148] + 6.69004*kdata[kdata&lt;=0.19148]**2)
  fidpolyFAR[kdata&gt;0.19148] = (1.0 - 1.84891*kdata[kdata&gt;0.19148] + 21.3479*kdata[kdata&gt;0.19148]**2 - 52.4846*kdata[kdata&gt;0.19148]**3 + 38.9541*kdata[kdata&gt;0.19148]**4)*1.03753

  fidNEAR=np.interp(kh,kdata,fidpolyNEAR)
  fidMID=np.interp(kh,kdata,fidpolyMID)
  fidFAR=np.interp(kh,kdata,fidpolyFAR)

  return fidnlratio, fidNEAR, fidMID, fidFAR



def sdss_lrgDR7_fiducial_setup(path,cosmo,h):
  ''' From MontePython 3.3.0, minor changes to work as stand-alone function
      and fix of use with python3
  '''

  # update in numpy's logspace function breaks python3 compatibility, fixed by using
  # goemspace function, giving same result as old logspace
  if PYTHON3:
    kh = np.geomspace(1e-3,1,num=int((math.log(1.0)-math.log(1e-3))/0.01)+1)
  else:
    kh = np.logspace(math.log(1e-3),math.log(1.0),num=(math.log(1.0)-math.log(1e-3))/0.01+1,base=math.exp(1.0))

  # Rescale the scaling factor by the fiducial value for h divided by the sampled value
  # h=0.701 was used for the N-body calibration simulations
  #scaling = scaling * (0.701/h)
  k = kh*h # k in 1/Mpc

  # Define redshift bins and associated bao 2 sigma value [NEAR, MID, FAR]
  z = np.array([0.235, 0.342, 0.421])
  sigma2bao = np.array([86.9988, 85.1374, 84.5958])
  # Initialize arrays
  # Analytical growth factor for each redshift bin
  D_growth = np.zeros(len(z))
  # P(k) *with* wiggles, both linear and nonlinear
  Plin = np.zeros(len(k), 'float64')
  Pnl = np.zeros(len(k), 'float64')
  # P(k) *without* wiggles, both linear and nonlinear
  Psmooth = np.zeros(len(k), 'float64')
  Psmooth_nl = np.zeros(len(k), 'float64')
  # Damping function and smeared P(k)
  fdamp = np.zeros([len(k), len(z)], 'float64')
  Psmear = np.zeros([len(k), len(z)], 'float64')
  # Ratio of smoothened non-linear to linear P(k)
  nlratio = np.zeros([len(k), len(z)], 'float64')
  # Loop over each redshift bin
  for j in range(len(z)):
      # Compute growth factor at each redshift
      # This growth factor is normalized by the growth factor today
      D_growth[j] = cosmo.scale_independent_growth_factor(z[j])
      # Compute Pk *with* wiggles, both linear and nonlinear
      # Get P(k) at right values of k in Mpc**3, convert it to (Mpc/h)^3 and rescale it
      # Get values of P(k) in Mpc**3
      for i in range(len(k)):
          Plin[i] = cosmo.pk_lin(k[i], z[j])
          Pnl[i] = cosmo.pk(k[i], z[j])
      # Get rescaled values of P(k) in (Mpc/h)**3
      Plin *= h**3 #(h/scaling)**3
      Pnl *= h**3 #(h/scaling)**3
      # Compute Pk *without* wiggles, both linear and nonlinear
      Psmooth = remove_bao(kh,Plin)
      Psmooth_nl = remove_bao(kh,Pnl)
      # Apply Gaussian damping due to non-linearities
      fdamp[:,j] = np.exp(-0.5*sigma2bao[j]*kh**2)
      Psmear[:,j] = Plin*fdamp[:,j]+Psmooth*(1.0-fdamp[:,j])
      # Take ratio of smoothened non-linear to linear P(k)
      nlratio[:,j] = Psmooth_nl/Psmooth


      fidnlratio, fidNEAR, fidMID, fidFAR = get_flat_fid(cosmo,kh,z,sigma2bao,h)

      #print('sdss_lrgDR7: Creating fiducial file with Omega_b = 0.25, Omega_L = 0.75, h = 0.701')
      #print('             Required for non-linear modeling')
      # Save non-linear corrections from N-body sims for each redshift bin
      arr=np.zeros((np.size(kh),7))
      arr[:,0]=kh
      arr[:,1]=fidNEAR
      arr[:,2]=fidMID
      arr[:,3]=fidFAR
      # Save non-linear corrections from halofit for each redshift bin
      arr[:,4:7]=fidnlratio
      np.savetxt(path+'/sdss_lrgDR7_fiducialmodel.dat',arr)
      #print('             Fiducial created')


if __name__ == &quot;__main__&quot;:

  # set output path where file with fiducial spectra will be saved
  # depending on which CLASS version is being installed
  path_to_classy = sys.argv[1]
  classy_version = sys.argv[2]

  # initialise variable cosmo. Will be overwritten with 
  # instance of CLASS'es python wrapper. Need to do it 
  # like this with overwriting to keep this script in-
  # dependent of the CLASS version that is used. 
  cosmo = None
  sys.path.insert(0,path_to_classy+&quot;/lib/&quot;)
  print(&quot;from classy_&quot;+classy_version+&quot; import Class&quot;)
  exec(&quot;from classy_&quot;+classy_version+&quot; import Class&quot;)
  exec(&quot;cosmo = Class()&quot;)

  # set run arguments for fiducial cosmology and call CLASS
  h = 0.701
  cosmo_arguments = {'P_k_max_h/Mpc': 1.5, 'ln10^{10}A_s': 3.0, 'N_ur': 3.04, 'h': h,
                                'omega_b': 0.035*0.701**2, 'non linear': ' halofit ', 'YHe': 0.24, 'k_pivot': 0.05,
                                'n_s': 0.96, 'tau_reio': 0.084, 'z_max_pk': 0.5, 'output': ' mPk ',
                                'omega_cdm': 0.215*0.701**2, 'T_cmb': 2.726}
  cosmo.set(cosmo_arguments)
  cosmo.compute(['lensing'])

  # call routines to write file with spectra of fiducial model
  sdss_lrgDR7_fiducial_setup(path_to_classy,cosmo,h)
</code></pre><hr><p>Updated on 2022-07-20 at 17:18:47 +0000</p><div class=edit-page><a href=https://github.com/RC1242RC/gambit_gh_pages/blob/master/content/en/documentation/code/Files/create__SDSSDR7__fid_8py.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://www.netlify.com/>Netlify</a>, <a class=text-muted href=https://gohugo.io/>Hugo</a>, and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/testbit/license/>License</a></li></ul></div></div></div></footer><script src=/testbit/js/bootstrap.min.54bf0932b8a36d0e152b1635b099a6ef1394d35327e2437550a075c9c8ed1bd8aed5847c21b36fc02ed24014c031d9ca24017b0c78b1639d7e2fa8329898b842.js integrity="sha512-VL8JMrijbQ4VKxY1sJmm7xOU01Mn4kN1UKB1ycjtG9iu1YR8IbNvwC7SQBTAMdnKJAF7DHixY51+L6gymJi4Qg==" crossorigin=anonymous defer></script>
<script src=/testbit/js/highlight.min.5b48bc253dc75aeea5fb366ecf700f4925e2b6eb1a1466f2124b722d68148d67bc0a9365d2b8ad9c585161b46372d23b08509a16f1fd518542b894756d4752d0.js integrity="sha512-W0i8JT3HWu6l+zZuz3APSSXitusaFGbyEktyLWgUjWe8CpNl0ritnFhRYbRjctI7CFCaFvH9UYVCuJR1bUdS0A==" crossorigin=anonymous defer></script>
<script src=/testbit/main.min.40265e9a032aeba5eaf67baac3cbbc22667a7533215d326eeb3e9f4d5e4be40f9ff4dcd22949db73ae527ca26a19d7998091a8973c82af760b2c0daa335190ed.js integrity="sha512-QCZemgMq66Xq9nuqw8u8ImZ6dTMhXTJu6z6fTV5L5A+f9NzSKUnbc65SfKJqGdeZgJGolzyCr3YLLA2qM1GQ7Q==" crossorigin=anonymous defer></script>
<script src=https://rc1242rc.github.io/testbit/index.min.a9e8ad821b751fa50133c3aa34a59cd35272c1cf2c5998ff27d4feca4a0d22445ae367b71bd8ea9be1e28558292ba08731585d275b00c18a8364fce62bfdcbd6.js integrity="sha512-qeitght1H6UBM8OqNKWc01Jywc8sWZj/J9T+ykoNIkRa42e3G9jqm+HihVgpK6CHMVhdJ1sAwYqDZPzmK/3L1g==" crossorigin=anonymous defer></script></body></html>